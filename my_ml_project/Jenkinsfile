pipeline {
    agent any

    environment {
        VENV = 'venv'
        OUTPUT_FILE = 'output.txt'
    }

    stages {
        stage('Checkout') {
            steps {
                checkout scm
            }
        }

stage('Set Up Python') {
    steps {
        script {
            sh 'sudo apt-get update'
            sh 'sudo apt-get install -y python3 python3-venv'
            sh 'python3 -m venv venv'
            sh '. venv/bin/activate'
        }
    }
}


        stage('Run Tests') {
            steps {
                script {
                    // Run tests using pytest within the virtual environment
                    sh "source ${VENV}/bin/activate && pytest tests/"
                }
            }
        }

        stage('Run ML Script') {
            steps {
                script {
                    // Run your ML script within the virtual environment
                    sh "source ${VENV}/bin/activate && python src/my_ml_script.py > ${OUTPUT_FILE}"
                }
            }
        }

        stage('Deployment') {
            steps {
                script {
                    // Upload the output file to a desired location
                    sh "cp ${OUTPUT_FILE} D:/LAB7/my_ml_project/${OUTPUT_FILE}"
                }
            }
        }

        stage('Deactivate Virtual Environment') {
            steps {
                script {
                    // Deactivate virtual environment after execution
                    sh ". ${VENV}/bin/deactivate || true"
                }
            }
        }
    }
}




